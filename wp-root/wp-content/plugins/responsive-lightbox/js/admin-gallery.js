var e;e=jQuery,ResponsiveLightboxGallery={modal:null,lastGalleryID:0,lastGalleryImage:"",currentGalleryID:0,resetFilters:!1,galleries:{},gutenberg:!1,primaryButtonClass:"",secondaryButtonClass:"",init(){this.gutenberg="undefined"!=typeof rlBlockEditor,this.searchGalleries=_.debounce(this.getGalleries,500),this.bindEvents(),this.setButtons()},searchGalleries(){},setButtons(){this.gutenberg?(this.primaryButtonClass=".rl-media-button-select-gallery",this.secondaryButtonClass=".rl-media-button-insert-gallery"):(this.primaryButtonClass=".rl-media-button-insert-gallery",this.secondaryButtonClass=".rl-media-button-select-gallery")},getModalButton(){return this.modal[0].getElementsByClassName("rl-media-button-select-gallery")[0]},open(l){void 0===l&&(l=0);let t="";e(this.primaryButtonClass).show(),e(this.secondaryButtonClass).hide(),this.resetFilters?(t="",e("#rl-media-search-input").val(""),this.modal.find("#rl-media-attachment-categories").val(0)):t=e("#rl-media-search-input").val(),this.modal.show(),this.setColumns(),this.getGalleries(t,l)},close(e){e.preventDefault(),this.modal.hide()},setColumns(){const e=this.modal.find(".rl-galleries-list"),l=e.width(),t=this.modal.find(".media-frame-content"),a=parseInt(t.attr("data-columns"));let s=a,i=a;if(l){const a=`${this.modal.find(".media-sidebar").outerWidth()}px`;e.css("right",a),this.modal.find(".attachments-browser .media-toolbar").css("right",a),i=Math.min(Math.round(l/170),12)||1,s&&s===i||t.attr("data-columns",i)}},handleClickGallery(l){l.preventDefault();const t=e(l.target).closest("li");if(this.currentGalleryID=parseInt(t.data("id")),this.lastGalleryID!==this.currentGalleryID){t.parent().find("li").removeClass("selected details"),this.lastGalleryID=this.currentGalleryID;const e=t.find(".centered").data("full-src");this.lastGalleryImage=""===e?t.find("img").first().attr("src"):e,t.addClass("selected details"),this.clickGallery(this.currentGalleryID,!1)}else t.hasClass("selected details")?(this.currentGalleryID=0,t.removeClass("selected details"),this.clickGallery(this.currentGalleryID,!0)):(t.addClass("selected details"),this.clickGallery(this.currentGalleryID,!1))},clickGallery(l,t){if(this.modal.find(".media-selection").toggleClass("empty",t),this.modal.find(this.primaryButtonClass).prop("disabled",t),!t){if(this.modal.find(".rl-attachments-list").empty(),this.galleries[l].inProgress)return void this.toggleSpinner(!0);this.galleries[l].ready?(this.toggleSpinner(!1),this.updateGalleryPreview(this.galleries[l].data,!1)):(this.toggleSpinner(!0),this.galleries[l].inProgress=!0,e.post(ajaxurl,{action:"rl-post-gallery-preview",post_id:rlArgsGallery.post_id,gallery_id:l,page:rlArgsGallery.page,nonce:rlArgsGallery.nonce}).done(e=>{try{e.success?(this.galleries[l].data=e.data,this.galleries[l].ready=!0,this.currentGalleryID===l&&this.updateGalleryPreview(this.galleries[l].data,!0)):this.galleries[l].ready=!1}catch(t){this.galleries[l].ready=!1}}).fail(()=>{this.galleries[l].ready=!1}).always(()=>{this.galleries[l].inProgress=!1,this.currentGalleryID===l&&this.toggleSpinner(!1)}))}},selectGallery(l){l.preventDefault(),e(l.currentTarget).attr("disabled")||this.modal.hide()},insertGallery(l){if(l.preventDefault(),e(l.currentTarget).attr("disabled"))return;const t=`[rl_gallery id="${this.lastGalleryID}"]`,a=tinyMCE.get("content");a&&!a.isHidden()?a.execCommand("mceInsertContent",!1,t):wp.media.editor.insert(t),this.modal.hide()},getGalleries(l,t){const a=this.modal,s=e(".rl-gallery-reload-spinner"),i=a.find(".rl-galleries-list");i.empty(),a.find(".media-selection").addClass("empty"),a.find(".rl-attachments-list").empty(),s.fadeIn("fast"),e.post(ajaxurl,{action:"rl-post-get-galleries",post_id:rlArgsGallery.post_id,search:l,page:rlArgsGallery.page,nonce:rlArgsGallery.nonce,category:this.resetFilters?0:a.find("#rl-media-attachment-categories").val()}).done(e=>{try{e.success&&(""!==e.data.html?(a.find(".rl-no-galleries").hide(),a.find(".rl-galleries-list").empty().append(e.data.html),e.data.galleries.forEach(e=>{this.galleries[e]={inProgress:!1,ready:!1,data:{}}}),0!==t&&i.find(`li[data-id="${t}"] .js--select-attachment`).trigger("click")):a.find(".rl-no-galleries").show())}catch(l){}}).always(()=>{s.fadeOut("fast")})},toggleSpinner(e){const l=this.modal.find(".rl-gallery-images-spinner"),t=this.modal.find(".selection-info");e?(l.fadeIn("fast").css("visibility","visible"),t.addClass("rl-loading-content")):(l.fadeOut("fast"),t.removeClass("rl-loading-content"))},updateGalleryPreview(e,l){this.modal.find(".rl-attachments-list").empty().append(e.attachments).fadeOut(0).delay(l?"fast":0).fadeIn(0),this.modal.find(".rl-gallery-count").text(e.count),""!==e.edit_url?this.modal.find(".rl-edit-gallery-link").removeClass("hidden").attr("href",e.edit_url):this.modal.find(".rl-edit-gallery-link").addClass("hidden").attr("href","")},reloadGalleries(l){l.preventDefault(),this.modal.find(".rl-no-galleries").hide(),this.galleries={},this.resetFilters=!1,this.getGalleries(e("#rl-media-search-input").val(),0)},bindEvents(){e(document).on("click","#rl-insert-modal-gallery-button",e=>{this.open(0)}),e(()=>{this.modal=e("#rl-modal-gallery"),this.modal.on("keyup","#rl-media-search-input",l=>{this.searchGalleries(e(l.currentTarget).val())}),this.modal.on("click",".rl-reload-galleries",e=>{this.reloadGalleries(e)}),this.modal.on("change","#rl-media-attachment-categories",e=>{this.reloadGalleries(e)}),this.modal.on("click",".media-modal-close, .media-modal-backdrop, .rl-media-button-cancel-gallery",e=>{this.close(e)}),this.modal.on("click",".rl-galleries-list li .js--select-attachment, .rl-galleries-list li button",e=>{this.handleClickGallery(e)}),this.modal.on("click",".rl-media-button-insert-gallery",e=>{this.insertGallery(e)}),this.modal.on("click",".rl-media-button-select-gallery",e=>{this.selectGallery(e)}),e(window).on("resize",()=>{this.setColumns()})})}},ResponsiveLightboxGallery.init();
